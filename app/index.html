<!DOCTYPE HTML>
<html>

<head>
    <!--<script src="../node_modules/jquery/dist/jquery.min.js"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="js/test.js"></script>
</head>

<body>
    <script>
        $(document).ready(function () {
            if (localStorage.getItem("idnumber") == null) {
                var idnumber = 0;
            }
            else var idnumber = localStorage.getItem("idnumber");

            //save the first localstorage for the finishedlist
            if (localStorage.getItem("finishedlist") == " ") {
                var aFinishtask = new Array;
            }
            else {
                aFinishtask = JSON.parse(localStorage.getItem("finishedlist"));
            }

            //output from the saved to do list
            if (localStorage.length != 0) {
                for (var i = 0; i < localStorage.length - 2; i++) {
                    var listID = "li" + i;
                    $("#to_do_list").append("<li id=" + listID + ">" + localStorage.getItem(listID) + "</li>");
                }
            }

            //output from the finished 
            if (aFinishtask != null) {
                for (var i = 0; i < aFinishtask.length; i++) {
                    if (aFinishtask.length == 0) break;
                    $("#finish_tasks").append("<li>" + aFinishtask[i] + "</li>");
                }
            }
            else if(aFinishtask == null)
            {
                aFinishtask = new Array;
            }

            //todolistelement prototype
            function pTolistElement(name, type, status, time) {
                this.taskname = name;
                this.tasktype = type;
                this.taskstatus = status;
                this.finishtime = time;
            }

            $("#input_list").keypress(function (event) {
                if (event.which == 13 && $("#input_list").val()) {
                    var IDlistelement = "li" + idnumber;
                    $("#to_do_list").append("<li id=" + IDlistelement + ">" + $("#input_list").val() + "</li>");
                    //save data to the localstorage
                    localStorage.setItem(IDlistelement, $("#input_list").val());
                    $("#input_list").val("");

                    //test idnumber
                    console.log(idnumber);
                    idnumber++;
                    localStorage.setItem("idnumber", JSON.stringify(idnumber));
                }
            })
            $("#to_do_list").on("click", "li", function (event) {
                //test for eventlistener and get the li id
                console.log($(this).attr("id"))
                var IDfinish = $(this).attr("id");

                //tests function
                console.log($(this).text());
                console.log(aFinishtask);

                aFinishtask.push($(this).text());
                $("#finish_tasks").append("<li>" + $(this).text() + "</li>");

                localStorage.removeItem(IDfinish);
                $("#" + IDfinish).remove();
                localStorage.setItem("finishedlist",JSON.stringify(aFinishtask));
            })

            $("#bClear").click(function () {
                localStorage.clear();
                location.reload();
            })
        })
    /*
        var idnumber = 0;
        //todolistelement prototype
        function pTolistElement(name, type, status, time) {
            this.taskname = name;
            this.tasktype = type;
            this.taskstatus = status;
            this.finishtime = time;

            this.output = function () {
                console.log(this.taskname + this.tasktype + this.taskstatus);
                return this.taskname + "&nbsp &nbsp &nbsp" + this.tasktype + "&nbsp &nbsp &nbsp" + this.finishtime;
            }
        }
        //initial finished element array
        var aFinishtask = new Array;

        //enter key function for input data
        function fEnterkey(event) {
            var x = event.key;
            if (x == "Enter" && $("#input_list").val() != "") {
                $(document).ready(function () {
                    var idstring = "li" + idnumber;// generate new id
                    $("#to_do_list").append("<li id=" + idstring + ">" + $("#input_list").val() + "</li>");
                    var name = $('#input_list').val();
                    //clear the input text
                    $("#input_list").val("");

                    //delete function
                    document.getElementById(idstring).onclick = function () {
                        //save the finished element in the finisharray
                        aFinishtask.push(new pTolistElement(name, "normal", "finish", new Date().toDateString()));
                        console.log("test click");// click test function
                        $("#" + idstring).remove();

                        //refresh the finished task lists
                        var length_finishtasks = aFinishtask.length;
                        var text = "<ol>";
                        text += "<p><b>Name &nbsp &nbsp Type  &nbsp &nbsp &nbsp  Finish Time </b> </p>";
                        for (var i = 0; i < length_finishtasks; i++) {
                            text += "<li> &nbsp " + aFinishtask[i].output() + "</li>";
                        }
                        text += "</ol>";
                        document.getElementById("finish_tasks").innerHTML = text;
                    }
                    idnumber++;
                })
            }
        }
    */
    </script>
    <p>Enter tasks:
        <input type="input_text" id="input_list" value="" size="10">
        <button id="bClear" size="5">Clear the list</button>
    </p>
    <h2>
        <b> To do list </b>
    </h2>
    <ul id="to_do_list">
    </ul>
    <p>
        <b>Finished Tasks Lists</b>
        <p id="finish_tasks"></p>
    </p>


</body>

</html>